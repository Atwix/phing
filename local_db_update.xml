<?xml version="1.0" ?>
<project name="atwix local db update" basedir="." default="build">
<property name="version" value="1.0" />
<property file="build.properties" />
<property name="privkeyfile" value="/home/jenkins/.ssh/id_rsa" /> 
<property name="pubkeyfile" value="/home/jenkins/.ssh/id_rsa.pub" /> 
<property name="remote.n98.path" value="${sync.destination.projectdir}/var/n98" />

<target name="remote-server-connect">
  <echo message="Connecting ${sync.remote.user}@${sync.remote.host}" />
  <ssh username="${sync.remote.user}" 
  host="${sync.remote.host}" 
  pubkeyfile="${pubkeyfile}"
  privkeyfile="${privkeyfile}"
  display="false"
  command="cd ${sync.destination.projectdir}/var/n98 2>&amp;1" 
  property="cd.output" />
  <if>
    <contains string="${cd.output}" substring="No such file" />
    <then>
      <phingcall target="-upload-n98" />
    </then>
  </if>
  <phingcall target="-execute-n98" />
</target>

<target name="-upload-n98">
  <echo message="Uploading n98-magerun.phar to the server" />
  <scp username="${sync.remote.user}"
  host="${sync.remote.host}"
  pubkeyfile="${pubkeyfile}"
  privkeyfile="${privkeyfile}"
  todir="${remote.n98.path}"
  file="../../system/n98/n98-magerun.phar" />
</target>

<target name="-execute-n98">
  <echo message="Executing n98-magerun.phar on the remote server" />
  <ssh username="${sync.remote.user}" 
  host="${sync.remote.host}" 
  pubkeyfile="${pubkeyfile}"
  privkeyfile="${privkeyfile}"
  display="false"
  command="${sync.destination.projectdir}/var/n98/n98-magerun.phar list 2>&amp;1" 
  property="n98.output" />
  <echo message="${n98.output}" />
</target>
</project>
